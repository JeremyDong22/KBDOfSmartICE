# KBD 系统测试计划

## 测试方法
- 使用 Chrome DevTools MCP 截图验证 UI
- 使用 Console Log 验证逻辑
- **内置可调时钟**：可以自由调整秒级时间，观察页面在那一秒是否变化

---

## 开发状态检查

### 已有功能
- [x] 时间窗口检测（getCurrentTimeSlot）
- [x] 地图初始化和头像显示
- [x] 打卡卡片基础功能
- [x] 不同媒体类型输入（image/text/voice/video）
- [x] 提交打卡
- [x] 三步动画（基础）
- [x] 头像灰色/彩色状态
- [x] 预览缩略图（基础显示）
- [x] 时间跳转按钮

### 缺失功能（需开发）
- [ ] **DEV-1**: 内置可调时钟（替代时间跳转按钮，支持秒级调整）
- [ ] **DEV-2**: 时间跳转面板可折叠
- [ ] **DEV-3**: 「营业中」「休息中」状态显示
- [ ] **DEV-4**: 打卡卡片居中 + 响应式重构
- [ ] **DEV-5**: 点击头像 → 历史打卡记录面板（悬浮窗口样式）
- [ ] **DEV-6**: 历史记录懒加载（每次10条）
- [ ] **DEV-7**: 未读标记系统（小绿点 + 绿色边框 + localStorage）
- [ ] **DEV-8**: 预览图点击放大（支持图片/语音/视频）
- [ ] **DEV-9**: 预览缩略图过时间窗口后消失

---

## 一、时间状态测试

### 测试 1.1：午市开店时间窗口（10:00-11:30）
**操作**：使用内置时钟调整到 10:30

**预期结果**：
- [ ] 顶部状态栏显示「● 午市开店」（绿色圆点）
- [ ] 地图有轻微模糊（如果当前用户未打卡）
- [ ] 弹出打卡卡片，显示今日任务
- [ ] 未打卡的头像：灰色/半透明
- [ ] 已打卡的头像：彩色 + 头像上方有预览缩略图

### 测试 1.2：午市营业中（11:30-13:30）
**操作**：使用内置时钟调整到 12:00

**预期结果**：
- [ ] 顶部状态栏显示「营业中」
- [ ] 地图清晰，无模糊
- [ ] **没有**打卡卡片弹出
- [ ] 所有头像都是彩色的（显示午市开店的打卡结果）
- [ ] 预览缩略图仍然显示（午市开店的上传内容）

### 测试 1.3：午市闭店时间窗口（13:30-15:30）
**操作**：使用内置时钟调整到 14:00

**预期结果**：
- [ ] 顶部状态栏显示「● 午市闭店」（绿色圆点）
- [ ] 所有头像统一变回灰色（新时间段，打卡记录清零）
- [ ] 之前的预览缩略图消失（过了时间窗口）
- [ ] 如果当前用户未打卡，地图模糊 + 弹出打卡卡片
- [ ] 加载午市闭店的任务

### 测试 1.4：晚市营业中（17:30-21:30）
**操作**：使用内置时钟调整到 19:00

**预期结果**：
- [ ] 顶部状态栏显示「营业中」
- [ ] 地图清晰，无模糊
- [ ] **没有**打卡卡片弹出
- [ ] 所有头像彩色（显示晚市开店的打卡结果）

### 测试 1.5：休息中（凌晨/早上）
**操作**：使用内置时钟调整到 08:00

**预期结果**：
- [ ] 顶部状态栏显示「休息中」
- [ ] 地图清晰，无模糊
- [ ] **没有**打卡卡片弹出
- [ ] 可以查看前一天最后时间段的打卡结果

### 测试 1.6：时间窗口边界（秒级测试）
**操作**：使用内置时钟从 11:29:58 调整到 11:30:02

**预期结果**：
- [ ] 11:29:59：仍显示「● 午市开店」
- [ ] 11:30:00：切换到「营业中」
- [ ] 页面状态在那一秒自动更新

---

## 二、打卡流程测试

### 测试 2.1：提交打卡（三步动画）
**前置条件**：在时间窗口内，用户未打卡，点击「提交打卡」

**预期结果**：
- [ ] **第一步**（≤200ms）：地图模糊消失，变清晰
- [ ] **第二步**（≈300ms）：卡片显示「✓ 已打卡」+ 「今日任务已完成」
- [ ] **第三步**（≈800ms后）：打卡卡片渐渐消失
- [ ] 我的头像变成彩色
- [ ] 我的头像上方出现预览缩略图（显示刚上传的内容）

### 测试 2.2：不同任务类型
**前置条件**：切换不同任务类型的时间段

**预期结果**：
- [ ] `notification` 类型：只显示确认按钮「✓ 确认已知晓」
- [ ] `text` 类型：显示文字输入框 + 提交按钮
- [ ] `image` 类型：显示拍照区域 + 拍照按钮
- [ ] `voice` 类型：显示录音按钮「按住说话」
- [ ] `video` 类型：显示视频录制按钮

---

## 三、头像交互测试

### 测试 3.1：点击头像 → 历史打卡记录
**操作**：点击任意一个头像

**预期结果**：
- [ ] 弹出历史打卡记录面板（悬浮窗口样式，背景是地图）
- [ ] 显示该员工的打卡历史列表
- [ ] 每条记录包含：日期、时间、打卡主题
- [ ] 初次加载 10 条
- [ ] 向下滚动触发懒加载，再加载 10 条
- [ ] 点击遮罩或关闭按钮退出

### 测试 3.2：未读标记（小绿点）
**前置条件**：有新的打卡记录未查看

**预期结果**：
- [ ] 头像右上角显示小绿点（未读）
- [ ] 预览缩略图边框为绿色（未读）
- [ ] 点击查看后，小绿点消失
- [ ] 预览缩略图边框变为白色（已读）
- [ ] 刷新页面后，已读状态保持（localStorage）

### 测试 3.3：预览缩略图
**前置条件**：在时间窗口内，有人已打卡

**预期结果**：
- [ ] 已打卡的头像上方显示预览缩略图
- [ ] 缩略图显示本次时间窗口内的上传内容
- [ ] 过了时间窗口后，预览缩略图消失

### 测试 3.4：预览图点击放大
**操作**：点击预览缩略图

**预期结果**：
- [ ] 图片类型：全屏放大查看
- [ ] 语音类型：播放音频
- [ ] 视频类型：播放视频
- [ ] 点击遮罩或关闭按钮退出

---

## 四、UI 美学测试

### 测试 4.1：打卡卡片居中
**测试设备**：iPhone SE / iPhone 14 Pro / iPad

**预期结果**：
- [ ] 打卡卡片在页面**正中间**（水平 + 垂直居中）
- [ ] 不会被状态栏或底部按钮遮挡

### 测试 4.2：打卡卡片响应式
**测试设备**：不同屏幕宽度

**预期结果**：
- [ ] 卡片宽度自适应，小屏不溢出
- [ ] 文字大小合适，不会太小或太大
- [ ] 标题不会换行到奇怪的位置
- [ ] 副标题（任务描述）合理换行
- [ ] 输入框/按钮大小适中，易于点击

### 测试 4.3：时间跳转面板（开发模式）
**预期结果**：
- [ ] 面板可折叠/展开
- [ ] 折叠时只显示一个小图标
- [ ] 展开时显示内置时钟 + 时间调整控件
- [ ] 生产环境可以完全隐藏

---

## 五、边界情况测试

### 测试 5.1：网络错误处理
- [ ] 打卡提交失败时显示错误提示
- [ ] 图片上传失败时可以重试
- [ ] 历史记录加载失败时显示提示

### 测试 5.2：空状态
- [ ] 没有任何打卡记录时显示空状态
- [ ] 历史记录为空时显示「暂无打卡记录」

### 测试 5.3：长文本
- [ ] 任务标题过长时正确截断或换行
- [ ] 任务描述过长时正确换行
- [ ] 员工姓名过长时正确显示

---

## 测试执行记录

| 测试编号 | 测试日期 | 结果 | 备注 |
|---------|---------|------|------|
| 1.1     |         |      |      |
| 1.2     |         |      |      |
| 1.3     |         |      |      |
| 1.4     |         |      |      |
| 1.5     |         |      |      |
| 1.6     |         |      |      |
| 2.1     |         |      |      |
| 2.2     |         |      |      |
| 3.1     |         |      |      |
| 3.2     |         |      |      |
| 3.3     |         |      |      |
| 3.4     |         |      |      |
| 4.1     |         |      |      |
| 4.2     |         |      |      |
| 4.3     |         |      |      |
| 5.1     |         |      |      |
| 5.2     |         |      |      |
| 5.3     |         |      |      |
